<ue-validation-wrapper validations="validation.messagesByField[config.modelProp.toLowerCase()]" class="ue-del-fraga">

  <ue-label config="::config.label" model="::model"></ue-label>

  <button type="button" id="{{model.diagnoser[0].diagnosKod}}-{{config.modelProp}}-dropdown"
       ng-click="openKategoriDropdown();$event.stopPropagation();" class="btn btn-default icf-button"
       ng-class="{'disabled': !hasICFDiagnos(), 'open': kategoriDropdown}" uib-popover="{{getPopoverText()}}"
       popover-trigger="mouseenter" popover-popup-delay="300" popover-append-to-body="true"
       popover-placement="auto top">
    <i class="material-icons bluetext">lightbulb_outline</i> Ta hjälp av ICF
    <i class="material-icons">{{kategoriDropdown ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</i>
</button>

  <div ng-if="kategoriDropdown" id="{{model.diagnoser[0].diagnosKod}}-{{config.modelProp}}-plate"
       class="funktions-dropdown-plate">
    <div class="kategori-header">
      <span>{{ config.modelProp == 'funktionsnedsattning' ?
          'Välj enbart de problem som påverkar patientens möjlighet att utföra sin sysselsättning.' :
          'Välj enbart de svårigheter som påverkar patientens sysselsättning.' }}</span>
    </div>
    <div class="kategori-content">
      <div class="kategori-content-padding">
      <div ng-if="kategorier.gemensamma[getKodTyp()] && (kategorier.gemensamma[getKodTyp()].centralaKoder.length > 0 ||
                  kategorier.gemensamma[getKodTyp()].kompletterandeKoder.length > 0)">
        <span class="kategori-label">ICF-kategorier för:</span><br />
        <strong class="medborder">{{diagnosBeskrivningen(kategorier.gemensamma[getKodTyp()].icd10Koder)}}</strong>
        <ue-icf-kategori kod="urval" ng-repeat="urval in kategorier.gemensamma[getKodTyp()].centralaKoder" class="kategori"></ue-icf-kategori>
        <ue-icf-kategori kod="urval" ng-repeat="urval in kategorier.gemensamma[getKodTyp()].kompletterandeKoder" class="kategori"></ue-icf-kategori>
      </div>

      <div class="unika-wrapper" ng-repeat="unika in kategorier.unika"
            ng-if="unika[getKodTyp()] && (unika[getKodTyp()].centralaKoder.length > 0 ||
                   unika[getKodTyp()].kompletterandeKoder.length > 0)">
        <span class="kategori-label">ICF-kategorier för:</span><br />
        <strong class="medborder">{{diagnosBeskrivningen(unika.icd10Kod)}}</strong>
        <ue-icf-kategori kod="urval" ng-repeat="urval in unika[getKodTyp()].centralaKoder" class="kategori"></ue-icf-kategori>
        <ue-icf-kategori kod="urval" ng-repeat="urval in unika[getKodTyp()].kompletterandeKoder" class="kategori"></ue-icf-kategori>
      </div>
      </div>
    </div>

    <div class="fader"></div>

    <div class="kategori-footer">
      <input type="button" class="btn btn-success kategori-add" ng-disabled="isInteractionDisabled()"
               value="{{model[config.kategoriProp].length > 0 ? 'Uppdatera' : 'Lägg till'}}"
               ng-click="add(kategorier)" />
      <input type="button" class="btn btn-secondary kategori-rensa" value="Avbryt" ng-click="rensa()" ng-disabled="isInteractionDisabled()"/>
      <a href="https://www.socialstyrelsen.se/klassificeringochkoder/koderfunktionstillstandicf" target="_blank">Läs mer
        om ICF hos Socialstyrelsen<i class="external-link-icon material-icons">launch</i></a>
    </div>
  </div>

  <div ng-if="model[config.kategoriProp].length > 0" class="problemContainer">
      <span class="problemListTitle">{{ config.modelProp == 'funktionsnedsattning' ?
          'Problem som påverkar patientens möjlighet att utföra sin sysselsättning:' :
          'Svårigheter som påverkar patientens sysselsättning:'}}</span>
    <span class="problem" ng-repeat="val in model[config.kategoriProp]">{{val}}</span>
  </div>

  <div ng-if="(focus || modelGetterSetter()) && model[config.kategoriProp].length > 0" class="placeholder">{{getPlaceHolder()}}</div>
  <textarea ng-attr-id="{{::config.modelProp|ueDomIdFilter}}" name="{{::config.modelProp}}" class="form-control"
            rows="{{::config.rows || 6}}" auto-expand ng-model="modelGetterSetter"
            ng-model-options="{ debounce: 500, getterSetter: true }" maxlength="{{::config.htmlMaxlength || 3500}}"
            ng-blur="updateValidation();focus=false" placeholder="{{(!focus && !modelGetterSetter()) && model[config.kategoriProp].length > 0 ? getPlaceHolder() : ''}}"
            ng-class="{'placeholderPadding': (focus || modelGetterSetter()) && model[config.kategoriProp].length > 0 }"
            ng-focus="focus=true">
  </textarea>
</ue-validation-wrapper>
