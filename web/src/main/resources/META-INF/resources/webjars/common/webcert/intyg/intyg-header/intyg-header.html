<div>
  <div wc-print-header title-id="{{intygstyp}}.label.certtitle" print-message-id="print.label.{{viewState.common.intyg.printStatus}}"
       intygs-id="viewState.common.intygModel.id"></div>

  <!-- error message -->
  <div id="cert-load-error" ng-show="viewState.common.doneLoading && viewState.common.activeErrorMessageKey"
       class="alert alert-danger alert-column print-hide">

    <span ng-if="!(intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined)">
      <span message key="{{viewState.common.activeErrorMessageKey}}"></span>
    </span>

    <div
        ng-if="intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined">
      <p>
        <span message key="{{viewState.common.activeErrorMessageKey}}"></span>
      </p>
      <p><strong>Intygsinformation</strong></p>
      <ul>
        <li>Patient: {{intygBackup.intyg.patientNamn}} ({{intygBackup.intyg.patientId.patientIdExtension}})</li>
        <li>Signerat: {{intygBackup.intyg.signeringsDatum | date:'short'}}</li>
        <li>ID: {{intygBackup.intyg.intygsId}}</li>
      </ul>
    </div>
  </div>

  <div ng-show="!viewState.common.activeErrorMessageKey" id="intyg-vy-laddad">
    <div class="print-hide">
      <div class="form-group buttonbar">
        <label class="control-label">{{viewState.intygModel.grundData.patient.fullstandigtNamn}} - {{viewState.intygModel.grundData.patient.personId}}</label>
        <div class="btn-row">
          <button type="button" id="sendBtn" class="btn btn-info"
                  ng-if="visaSkickaKnappen()"
                  wc-authority feature="skickaIntyg" request-origin="!UTHOPP" intygstyp="{{intygstyp}}"
                  wc-check-vardenhet vardenhet="{{viewState.enhetsId}}"
                  ng-click="send()"><span message key="{{intygstyp}}.button.send"></span>
          </button>
          <button type="button" id="downloadprint"
                  class="btn btn-info"
                  wc-authority
                  intygstyp="{{intygstyp}}"
                  feature="!arbetsgivarUtskrift"
                  ng-click="print(viewState.intygModel, false)">
            Skriv ut
          </button>
          <div id="downloadprintemployer"
               style="display:inline;"
               wc-authority
               feature="arbetsgivarUtskrift"
               intygstyp="{{intygstyp}}">
            <div class="btn-group"
                 ng-if="!viewState.common.intyg.isRevoked && !viewState.common.isIntygOnRevokeQueue">
              <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Skriv ut <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li><a href="#" onClick="return false;" ng-click="print(viewState.intygModel, false)">Fullständigt intyg</a></li>
                <li><a href="#" onClick="return false;" ng-click="print(viewState.intygModel, true)">Intyg till arbetsgivaren</a></li>
              </ul>
            </div>
            <button type="submit"
                    value="submit"
                    class="btn btn-info"
                    ng-if="viewState.common.intyg.isRevoked || viewState.common.isIntygOnRevokeQueue"
                    ng-click="print(viewState.intygModel, false)">
              Skriv ut
            </button>
          </div>
          <button type="button"
                  wc-authority="KOPIERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="copyBtn"
                  class="btn btn-info"
                  ng-if="!viewState.common.intyg.isRevoked && !viewState.common.isIntygOnRevokeQueue && !viewState.common.common.sekretessmarkering"
                  ng-click="copy(viewState.intygModel)"
                  uib-popover="{{copyBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true">
            Kopiera
          </button>
          <button type="button"
                  wc-authority="KOPIERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="fornyaBtn"
                  class="btn btn-info"
                  ng-if="intygstyp === 'fk7263' && !viewState.common.intyg.isRevoked && !viewState.common.isIntygOnRevokeQueue && !viewState.common.common.sekretessmarkering"
                  ng-click="fornya(viewState.intygModel)"
                  uib-popover="{{fornyaBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true">
            Förnya
          </button>
          <button type="button"
                  wc-authority="MAKULERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="makuleraBtn"
                  class="btn btn-inverse"
                  ng-if="!viewState.common.intyg.isRevoked && !viewState.common.isIntygOnRevokeQueue"
                  ng-click="makulera(viewState.intygModel)"
                  wc-check-vardenhet
                  vardenhet="{{viewState.enhetsId}}"
                  uib-popover="Makulera intyg innebär att intyget återtas. Vid behov kan intyget ersättas med ett nytt."
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true">
            Makulera
          </button>
        </div>
      </div>

      <div wc-secrecy-mark-message person-id="viewState.intygModel.grundData.patient.personId" type="intyg"></div>

      <div id="cert-inline-error" ng-show="viewState.common.inlineErrorMessageKey" class="alert alert-danger alert-column print-hide">
        <span message key="{{viewState.common.inlineErrorMessageKey}}"></span>
      </div>

      <div wc-new-person-id-message></div>

      <div class="alert alert-info alert-column" ng-if="!viewState.common.intyg.isRevoked && !viewState.common.isIntygOnRevokeQueue">
        <strong>Status:</strong>
        <span ng-if="viewState.common.intyg.isSent" id="certificate-is-sent-to-recipient-message-text" message key="{{intygstyp}}.label.status.recieved"></span>
        <span ng-if="!viewState.common.intyg.isSent && !viewState.common.isIntygOnSendQueue" id="certificate-is-sent-to-it-message-text" message key="{{intygstyp}}.label.status.signed"></span>
        <span ng-if="!viewState.common.intyg.isSent && viewState.common.isIntygOnSendQueue" id="certificate-is-on-sendqueue-to-it-message-text" message key="{{intygstyp}}.label.status.sent"></span>
      </div>

      <div ng-if="viewState.common.intyg.isRevoked || viewState.common.isIntygOnRevokeQueue" id="certificate-is-revoked-message-text" class="alert alert-warning"
           style="margin-right: 20px; max-width: 530px;">
        <span ng-if="viewState.common.isIntygOnRevokeQueue" id="certificate-revoked-it-message-text" message key="cert.status.revoke.requested"></span>
        <span ng-if="viewState.common.intyg.isRevoked && (!viewState.common.isIntygOnRevokeQueue || viewState.common.isIntygOnRevokeQueue == 'undefined')" id="certificate-revoked-on-queue-it-message-text" message key="cert.status.revoke.confirmed"></span>
      </div>


    </div>
  </div>
</div>
