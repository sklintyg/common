<wc-spinner label="common.loading.existing.arenden" show-spinner="!viewState.doneLoading">

<div class="tab-content-title-row">

  <ul class="nav navbar-nav" ng-if="viewState.intygProperties.isSent">
    <li ng-class="{active: isFilterKomplettering}">
      <a ng-click="setFilterKomplettering(true)" id="arende-filter-kompletteringsbegaran">
        Kompletteringsbegäran
        <span id="arende-kompletteringsbegaran-count" class="badge badge__stat" ng-if="viewState.intygProperties.isInteractionEnabled && unhandledKompletteringCount > 0">
          {{unhandledKompletteringCount}}
        </span>
      </a>
    </li>
    <li ng-class="{active: !isFilterKomplettering}">
      <a ng-click="setFilterKomplettering(false)" id="arende-filter-administrativafragor">
        Administrativa frågor
        <span id="arende-administrativafragor-count" class="badge badge__stat" ng-if="viewState.intygProperties.isInteractionEnabled && unhandledAdministrativaFragorCount > 0">
          {{unhandledAdministrativaFragorCount}}
        </span>
      </a>
    </li>
  </ul>

</div>

<wc-support-panel-scrollable-body dom-id="arende-panel-scrollable-body">

  <wc-deprecated-intygstype-message message-suffix="arendeheader" intygs-type="{{::viewState.intygProperties.type}}"></wc-deprecated-intygstype-message>

    <!-- error message -->
    <wc-alert-message id="arende-list-load-error"
                      ng-show="viewState.intygProperties.isLoaded && viewState.doneLoading && viewState.activeErrorMessageKey" alert-severity="danger">
      <span dynamic-label key="common.error.{{viewState.activeErrorMessageKey}}"></span>
    </wc-alert-message>

    <wc-arende-intyg-not-sent-message ng-if="!viewState.intygProperties.isSent"></wc-arende-intyg-not-sent-message>

    <div id="arende-kompletteringar-section" class="arende-list-section" ng-show="viewState.intygProperties.isSent && isFilterKomplettering">
      <wc-arende-komplettera-utkast-warning></wc-arende-komplettera-utkast-warning>

      <div ng-if="viewState.intygProperties.isInteractionEnabled">    
        <wc-arende-komplettera-intyg-confirmation></wc-arende-komplettera-intyg-confirmation>
        <wc-arende-komplettera-meddelande-confirmation arende-list="viewState.arendeList"></wc-arende-komplettera-meddelande-confirmation>
      </div>

      <!-- list of komplettering arenden -->
      <div ng-repeat="arendeListItem in viewState.arendeList | filter:kompletteringarFilter | orderBy:['-arende.senasteHandelse'] as kompletteringarList"
           class="arende-item">
        <arende-panel last-card="$last" panel-id="kompletteringar" arende-list-item="arendeListItem" arende-list="viewState.arendeList"
             parent-view-state="viewState"></arende-panel>
      </div>

      <wc-arende-no-kompletteringar-message ng-if="kompletteringarList.length === 0"></wc-arende-no-kompletteringar-message>

    </div>

    <div id="arende-administrativafragor-section" class="arende-list-section" ng-show="viewState.intygProperties.isSent && !isFilterKomplettering">

      <!-- new arende form -->
      <arende-new ng-show="viewState.intygProperties.isInteractionEnabled && viewState.doneLoading && viewState.activeErrorMessageKey == null"
           arende-list="viewState.arendeList" parent-view-state="viewState"></arende-new>
      <div class="card-divider"></div>

      <!-- list of administrativ fraga arenden -->
      <div
          ng-repeat="arendeListItem in viewState.arendeList | filter:administrativaFragorFilter | orderBy:['-arende.senasteHandelse'] as administrativaFragorList"
          class="arende-item">
        <arende-panel last-card="$last" panel-id="administrativaFragor" arende-list-item="arendeListItem" arende-list="viewState.arendeList"
             parent-view-state="viewState"></arende-panel>
      </div>

      <wc-arende-no-administrativa-fragor-message ng-if="administrativaFragorList.length === 0"></wc-arende-no-administrativa-fragor-message>

    </div>

</wc-support-panel-scrollable-body>

<wc-arende-footer ng-if="viewState.intygProperties.isInteractionEnabled" arende-list="viewState.arendeList"></wc-arende-footer>

</wc-spinner>
<!--  end spinner -->
